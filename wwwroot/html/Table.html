<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Table</title>
    <!-- Materialize CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
    <!-- Materialize JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script>
        async function Server() {
            StopConnection();
            window.location.href = '/TCP-Server';
        }
        async function StartConnection() {
            const connectionPort = document.getElementById('connectionPort').value;
            await fetch(`/api/Table/start?connectionPort=${connectionPort}`);
        }
        async function StopConnection() {
            await fetch('/api/Table/stop');
        }

        async function updateData() {
            const response = await fetch(`/api/Table/GetConnectionStatus`);
            const connectionStatus = await response.text();
            document.getElementById(`conectionStatus`).innerHTML = connectionStatus;

            // *** Работа с таблицей ***
            const modbusID = document.getElementById('modbusID').value;
            if (modbusID != "") {
                const tableDataResponse = await fetch(`/api/Table/GetTableData?modbusID=${modbusID}`);
                const tableData = await tableDataResponse.json();

                const tableBody = document.getElementById('tableBody');
                tableBody.innerHTML = ''; // Очистка текущей таблицы

                tableData.forEach((row, index) => {
                    const tr = document.createElement('tr');

                    // Добавление столбца с названиями параметров
                    const tdName = document.createElement('td');
                    tdName.textContent = `Parameter ${index + 1}`; // Пример названия параметра
                    tr.appendChild(tdName);

                    const tdAddress = document.createElement('td');
                    tdAddress.textContent = index + 1;
                    tr.appendChild(tdAddress);

                    const tdValue = document.createElement('td');
                    tdValue.textContent = row;
                    tr.appendChild(tdValue);

                    tableBody.appendChild(tr);
                });
            }
        }

        setInterval(updateData, 10); // Обновление каждые 100 миллисекунд
        updateData(); // Первоначальное обновление
    </script>
</head>
<body>
    <header>
        <nav class="waves-effect waves-light teal">
            <div class="nav-wrapper">
                <ul id="nav" style=" margin-inline:15px ;" class="left hide-on-med-and-down">
                    <li><a href="#" onclick="Server()">Buss </a></li>
                    <li><a href="#" onclick="StartConnection()">Start</a></li>
                    <li><a href="#" onclick="StopConnection()">Stop</a></li>
                    <li><a href="#" style="font-weight: 600; padding-left: 20px; padding-right: 20px; " ;" class="brand-logo">Device-Table</a> </li>
                </ul>
            </div>
        </nav>
    </header>
    <div class="container">
        <div>
            <h4 id="conectionStatus"></h4>
            <input type="number" id="connectionPort" placeholder="Enter connection port" />
            <input type="number" id="modbusID" placeholder="ModbusID">
        </div>
        <table>
            <thead>
                <tr>
                    <th>Название параметра</th>
                    <th>Адрес</th>
                    <th>Значение в uint16 (dec)</th>
                </tr>
            </thead>
            <tbody id="tableBody">
            </tbody>
        </table>
    </div>
</body>
</html>