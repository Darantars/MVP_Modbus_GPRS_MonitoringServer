<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>GPRS-Server</title>
    <!-- Materialize CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
    <style>
        /* Переопределение стандартной подсветки на голубой цвет */
        .input-field input:focus {
            border-bottom: 2px solid #2196F3 !important; /* Голубой цвет */
            box-shadow: 0 1px 0 0 #2196F3 !important; /* Голубой цвет */
        }

       .input-field input:focus + label {
            color: #2196F3 !important; /* Голубой цвет */
       }
    </style>
    <!-- Materialize JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script>
        async function Home() {
            await fetch('/api/TCP/stop');
            window.location.href = '/Home';
        }

        async function StartConnection() {
            const connectionPort = document.getElementById('connectionPort').value;
            await fetch(`/api/TCP/start?connectionPort=${connectionPort}`);
        }

        async function StopConnection() {
            await fetch('/api/TCP/stop');
        }

        async function updateData() {
            const response = await fetch('/api/TCP/read');
            const data = await response.text();
            const newData = `<div>${data}</div>`;
            document.getElementById('data').innerHTML = newData;

            const response1 = await fetch('/api/TCP/updateConnectionStatus');
            const connection = await response1.text();
            const newStatus = `${connection}`;
            document.getElementById('connectionStatus').innerHTML = newStatus;
        }

        async function SendToDevice() {
            const message = document.getElementById('messageInput').value;
            const response = await fetch('/api/TCP/send', {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain'
                },
                body: message
            });

            if (response.ok) {
                alert('Message sent successfully!');
            } else {
                const errorText = await response.text();
                alert('Failed to send message: ' + errorText);
            }
        }

        async function SendMb3ReadToDevice() {
            const modbusID = document.getElementById('modbusID').value;
            const modbusStartAdress = document.getElementById('modbusStartAdress').value;
            const modbusInput =
            {
                modbusID: modbusID,
                modbusStartAdress: modbusStartAdress
            };
            const response = await fetch('/api/TCP/sendMb3',
                {
                    method: 'POST',
                    headers:
                    {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(modbusInput)
                });
            if (response.ok) {
                alert('Modbus command sent successfully!');
            }
            else {
                const errorText = await response.text();
                alert('Failed to send Modbus command: ' + errorText);
            }
        }

        async function SendMb10WriteToDevice() {
            const modbusID = document.getElementById('modbusID').value;
            const modbusStartAdress = document.getElementById('modbusStartAdress').value;
            const modbussQuanity = document.getElementById('modbussQuanity').value;
            const modbussData = document.getElementById('modbussData').value;

            const modbusInput =
            {
                modbusID: modbusID,
                modbusStartAdress: modbusStartAdress,
                modbussQuanity: modbussQuanity,
                modbussData: modbussData
            };
            const response = await fetch('/api/TCP/sendMb10',
                {
                    method: 'POST',
                    headers:
                    {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(modbusInput)
                });
            if (response.ok) {
                alert('Modbus command sent successfully!');
            }
            else {
                const errorText = await response.text();
                alert('Failed to send Modbus command: ' + errorText);
            }
        }


        setInterval(updateData, 200); // Обновление каждые 200 миллисекунд
        updateData(); // Первоначальное обновление
    </script>
</head>
<body>
    <header>
        <nav class="waves-effect waves-light blue">
            <div class="nav-wrapper">
                <ul id="nav" style=" margin-inline:15px ;" class="left hide-on-med-and-down">
                    <li><a onclick="Home()">Home</a></li>
                    <li><a onclick="StartConnection()">Start</a></li>
                    <li><a onclick="StopConnection()">Stop</a></li>
                    <li><a style="font-weight: 600; padding-left: 20px; padding-right: 20px;" ;" class="brand-logo">GPRS-Buss</a> </li>
                </ul>
            </div>
        </nav>
    </header>
    <div class="container">
        <div class="col s12">
            <div class="input-field col s6">
                <input type="number" id="connectionPort" placeholder="Enter connection port" />
            <div/>
            <h5 id="connectionStatus">Offline</h5>
        </div>

            <div id="sendZone" class="row">
                <div class="input-field col s6">
                    <input id="messageInput" type="text" class="validate">
                    <label for="messageInput">Message ASCII</label>
                </div>
                <button class="btn waves-effect waves-light blue" onclick="SendToDevice()">Send Message</button>
            </div>
            <div id="ModbusComand" class="row">
                <div class="input-field col s6">
                    <input type="number" id="modbusID" placeholder="ModbussID">
                    <input type="number" id="modbusStartAdress" placeholder="ModbussAdress">
                </div>
                <div class="input-field col s6">
                    <input type="number" id="modbussQuanity" placeholder="ModbussQuanity">
                    <input type="text" id="modbussData" placeholder="ModbussData">
                </div>
            </div>
            <div class="col s12">
                <button class="btn waves-effect waves-light blue" onclick="SendMb3ReadToDevice()">Send MB Read 3 Command</button>
                <button class="btn waves-effect waves-light blue" onclick="SendMb10WriteToDevice()">Send MB Read 10 Command</button>
            </div>
            <div class="row">
                <p id="data">Await start</p>
            </div>
        </div>
</body>
</html>